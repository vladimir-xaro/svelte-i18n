{
  "version": 3,
  "sources": ["../src/index.ts"],
  "sourcesContent": ["import { Readable, Writable, derived, readonly, writable } from 'svelte/store';\nimport isObject from 'isobject';\nimport deepmerge from 'deepmerge';\n// import merge from 'merge';\n\nexport type Translation = {\n    [K: string]: string|Translation;\n};\n\nexport type InitOptions = {\n    translations?:          Record<string, Translation>;\n    locale?:                string | null;\n    defaultTranslations?:   Record<string, string>;\n}\n\nexport interface CurrentLocaleStore extends Writable<string|null> {\n    setNullIf(this: void, locale: string|null): void;\n}\n\nconst currentLocale: CurrentLocaleStore = (() => {\n    const { set, subscribe } = writable<string|null>(null);\n    let val: string|null = null;\n    subscribe((_val) => {\n        val = _val;\n    });\n\n    /**\n     * @throws { Error } If locale not found\n     */\n    const _set = (locale: string|null) => {\n        if (locale === val) {\n            return;\n        }\n\n        if (locale === null) {\n            set(null);\n            return;\n        }\n\n        if (locale in _allTranslations === false) {\n            throw new Error(`[@xaro/svelte-i18n] No translations for locale: \"${locale}\"`);\n        }\n\n        set(locale);\n    }\n\n    const _update = (cb: (locale: string|null) => string|null) => _set(cb(val));\n\n    const setNullIf = (locale: string|null) => {\n        if (val !== null && locale === val) {\n            _set(locale);\n        }\n    }\n\n    return {\n        set:    _set,\n        update: _update,\n        subscribe,\n        setNullIf,\n    }\n})();\n\nexport {\n    currentLocale as locale\n};\n\nlet _defaultTranslations: Record<string, string> = {};\nconst defaultTranslations: Writable<Record<string, string>> = writable<Record<string, string>>(_defaultTranslations);\ndefaultTranslations.subscribe(s => _defaultTranslations = s);\n\nconst _allLocales: Writable<Set<string>> = writable<Set<string>>(new Set());\nexport const allLocales: Readable<Set<string>> = readonly(_allLocales);\n\nconst _allTranslations: Record<string, Translation> = {};\n(<any>window).allTranslations = _allTranslations;\n\nexport const init = (options?: InitOptions) => {\n    if (!options) {\n        return;\n    }\n\n    if ('translations' in options) {\n        if (!isObject(options.translations)) {\n            throw new Error(`[@xaro/svelte-i18n] options.translations must be an object if passed`);\n        }\n\n        Object.assign(_allTranslations, options.translations);\n\n        _allLocales.update(s => {\n            for (const key in options.translations) {\n                s.add(key);\n            }\n            return s;\n        });\n    }\n\n    if ('defaultTranslations' in options) {\n        if (! isObject(options.defaultTranslations)) {\n            throw new Error(`[@xaro/svelte-i18n] options.defaultTranslations must be an object if passed`);\n        }\n\n        if (Object.keys(options.defaultTranslations!).length) {\n            defaultTranslations.update(s => {\n                Object.assign(s, options.defaultTranslations);\n                return s;\n            });\n        }\n    }\n\n    if ('locale' in options) {\n        if (typeof options.locale !== 'string') {\n            throw new Error(`[@xaro/svelte-i18n] options.locale must be a string, ${typeof options.locale} passed`);\n        }\n\n        if (options.locale! in _allTranslations === false) {\n            throw new Error(`[@xaro/svelte-i18n] No translations for locale: ${options.locale}`);\n        }\n\n        currentLocale.set(options.locale);\n    }\n}\n\nexport const hasLocale = (locale: string) => locale in _allTranslations;\n\nexport const removeLocale = (locale: string) => {\n    if (locale in _allTranslations) {\n        delete _allTranslations[locale];\n\n        currentLocale.setNullIf(locale);\n\n        return true;\n    }\n\n    return false;\n}\n\nexport const setTranslation = (\n    locale:     string,\n    path:       string|string[],\n    value:      string|Translation,\n    setLocale:  boolean = false\n) => {\n    if (locale in _allTranslations === false) {\n        // throw new Error(`[@xaro/svelte-i18n] No translations for locale: ${locale}`);\n        _allTranslations[locale] = {};\n        _allLocales.update(s => s.add(locale));\n    }\n\n    let arr: string[] = Array.isArray(path) ? path : path.split(/\\.+/);\n\n    if (!arr.length) {\n        if (!isObject(value)) {\n            throw new Error('[@xaro/svelte-i18n] Translation cannot be a string when no path is given');\n        }\n\n        _allTranslations[locale] = <Translation>value;\n\n        return;\n    }\n\n    let obj = _allTranslations[locale];\n\n    for (let i = 0; i < arr.length; i++) {\n        const key = arr[i];\n        if (!key) {\n            throw new Error('[@xaro/svelte-i18n] Path cannot be empty, end or begin with a separator character');\n        } else if (i === arr.length - 1) {\n            obj[key] = value;\n        } else {\n            if (key in obj === false) {\n                obj[key] = {};\n            }\n            obj = <Translation>obj[key];\n        }\n    }\n\n    if (setLocale) {\n        currentLocale.set(locale);\n    }\n}\n\nexport const addTranslation = (\n    locale:     string,\n    path:       string|string[],\n    value:      string|Translation,\n    setLocale:  boolean = false\n) => {\n    if (locale in _allTranslations === false) {\n        // throw new Error(`[@xaro/svelte-i18n] No translations for locale: ${locale}`);\n        setTranslation(locale, path, value);\n        return;\n    }\n\n    let arr: string[] = Array.isArray(path) ? path : path.split(/\\.+/);\n\n    if (!arr.length) {\n        if (!isObject(value)) {\n            throw new Error('[@xaro/svelte-i18n] Translation cannot be a string when no path is given');\n        }\n\n        _allTranslations[locale] = <Translation>value;\n\n        return;\n    }\n\n    let obj = _allTranslations[locale];\n\n    for (let i = 0; i < arr.length; i++) {\n        const key = arr[i];\n        if (!key) {\n            throw new Error('[@xaro/svelte-i18n] Path cannot be empty, end or begin with a separator character');\n        } else if (i === arr.length - 1) {\n            if (key in obj && isObject(obj[key]) && isObject(value)) {\n                obj[key] = deepmerge(<Translation>obj[key], <Translation>value);\n            } else {\n                obj[key] = value;\n            }\n        } else {\n            if (key in obj === false) {\n                obj[key] = {};\n            }\n            obj = <Translation>obj[key];\n        }\n    }\n\n    if (setLocale) {\n        currentLocale.set(locale);\n    }\n}\n\nexport const removeTranslation = (\n    locale:     string,\n    path:       string|string[],\n    setLocale:  boolean = false\n) => {\n    if (locale in _allTranslations === false) {\n        throw new Error(`[@xaro/svelte-i18n] No translations for locale: ${locale}`);\n    }\n\n    let obj = _allTranslations[locale];\n\n    let arr: string[] = Array.isArray(path) ? path : path.split(/\\.+/);\n\n    for (let i = 0; i < arr.length; i++) {\n        const key = arr[i];\n        if (!key) {\n            throw new Error('[@xaro/svelte-i18n] Path cannot be empty, end or begin with a separator character');\n        } else if (i === arr.length - 1) {\n            delete obj[key];\n        } else {\n            if (key in obj === false) {\n                obj[key] = {};\n            }\n            obj = <Translation>obj[key];\n        }\n    }\n\n    if (setLocale) {\n        currentLocale.set(locale);\n    }\n}\n\nconst translate = (\n    $locale:        string|null,\n    path:           string|string[],\n    params?:        Record<string, any>,\n    defaultValue?:  string\n) => {\n    const returnDefault = () => {\n        return defaultValue || (\n            $locale && $locale in _defaultTranslations\n                ? _defaultTranslations[$locale!]\n                : (Array.isArray(path) ? path.join(',') : path)\n        );\n    }\n\n    if (\n        $locale === null ||\n        $locale in _allTranslations === false\n    ) {\n        return returnDefault();\n    }\n    \n    let obj: Translation = _allTranslations[$locale];\n\n    const withdraw = (key: string) => {\n        if (typeof obj[key] === 'string') {\n            let val = <string>obj[key];\n            if (isObject(params)) {\n                const keys = Object.keys(params!);\n                if (keys.length) {\n                    for (const key of keys) {\n                        val = val.replaceAll(`{{${key}}}`, params![key]);\n                    }\n                }\n            }\n            return val;\n        }\n\n        obj = <Translation>obj[key];\n\n        return null;\n    }\n\n    if (Array.isArray(path)) {\n        loop:\n        for (const item of path) {\n            if (item in obj) {\n                const val = withdraw(item);\n                if (val !== null) {\n                    return val;\n                }\n            } else {\n                const parts = item.split('.');\n                parts.splice(-1);\n                while (parts.length) {\n                    const _item = parts.join('.');\n                    if (_item in obj) {\n                        const val = withdraw(item);\n                        if (val !== null) {\n                            return val;\n                        }\n                        continue loop;\n                    } else {\n                        parts.splice(-1);\n                    }\n                }\n                return returnDefault();\n            }\n        }\n    } else {\n        const parts = path.split('.');\n        for (const part of parts) {\n            if (part in obj) {\n                const val = withdraw(part);\n                if (val !== null) {\n                    return val;\n                }\n            } else {\n                return defaultValue || path;\n            }\n        }\n    }\n\n    return returnDefault();\n}\n\nexport const t = derived(\n    currentLocale,\n    ($locale) =>\n        (path: string|string[], params: Record<string, any> = {}, defaultValue?: string) =>\n            translate($locale, path, params, defaultValue)\n);"],
  "mappings": "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",
  "names": ["derived", "readonly", "writable", "isObject", "deepmerge", "currentLocale", "set", "subscribe", "val", "_val", "_set", "locale", "_allTranslations", "cb", "_defaultTranslations", "defaultTranslations", "s", "_allLocales", "allLocales", "init", "options", "key", "hasLocale", "removeLocale", "setTranslation", "path", "value", "setLocale", "arr", "obj", "i", "addTranslation", "removeTranslation", "translate", "$locale", "params", "defaultValue", "returnDefault", "withdraw", "keys", "loop", "item", "parts", "part", "t"]
}
